<div class="container mx-auto px-4 py-6 sm:py-8 max-w-7xl">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 mb-6">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold">Integracje</h1>
      <p class="text-sm text-base-content/60 mt-1">Zarządzaj połączeniami z zewnętrznymi platformami</p>
    </div>
    <%= link_to "Dodaj integrację", new_integration_path, class: "btn btn-primary w-full sm:w-auto" %>
  </div>
  <% if @integrations.any? %>
    <!-- Integrations by Type -->
    <% Integration.integration_types.keys.each do |type| %>
      <% integrations_of_type = @integrations_by_type[type] || [] %>
      <% next if integrations_of_type.empty? %>
      <div class="mb-8">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <%= Integration.integration_type_label(type) %>
          <span class="badge badge-sm"><%= integrations_of_type.count %></span>
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <% integrations_of_type.each do |integration| %>
            <div class="card bg-base-100 border border-base-300 shadow-sm">
              <div class="card-body">
                <!-- Header with status badge -->
                <div class="flex items-start justify-between mb-3">
                  <div class="flex items-center gap-2">
                    <%= lucide_icon("plug", class: "w-5 h-5 text-primary") %>
                    <h3 class="font-semibold text-lg"><%= integration.provider_name %></h3>
                  </div>
                  <span class="badge <%= integration.status_badge_class %> badge-sm">
                    <%= integration.status_name %>
                  </span>
                </div>
                <!-- Integration info -->
                <div class="space-y-2 text-sm">
                  <% if integration.provider_account_name.present? %>
                    <div class="flex items-center gap-2 text-base-content/70">
                      <%= lucide_icon("user", class: "w-4 h-4") %>
                      <span><%= integration.provider_account_name %></span>
                    </div>
                  <% end %>
                  <% if integration.last_synced_at.present? %>
                    <div class="flex items-center gap-2 text-base-content/70">
                      <%= lucide_icon("refresh-cw", class: "w-4 h-4") %>
                      <span>Synchronizacja: <%= time_ago_in_words(integration.last_synced_at) %> temu</span>
                    </div>
                  <% else %>
                    <div class="flex items-center gap-2 text-warning">
                      <%= lucide_icon("alert-circle", class: "w-4 h-4") %>
                      <span>Nigdy nie synchronizowano</span>
                    </div>
                  <% end %>
                  <% if integration.last_error_message.present? %>
                    <div class="alert alert-error py-2 px-3 text-xs mt-2">
                      <%= lucide_icon("alert-triangle", class: "w-4 h-4") %>
                      <span><%= truncate(integration.last_error_message, length: 60) %></span>
                    </div>
                  <% end %>
                </div>
                <!-- Actions -->
                <div class="card-actions justify-end mt-4 pt-4 border-t border-base-300">
                  <% if integration.can_sync? && ["baselinker", "sellasist"].include?(integration.provider) %>
                    <%= button_to "Synchronizuj", sync_now_integration_path(integration), 
                        method: :post,
                        class: "btn btn-sm btn-outline btn-primary",
                        data: { turbo_confirm: "Rozpocząć synchronizację?" } %>
                  <% end %>
                  <%= link_to "Edytuj", edit_integration_path(integration), class: "btn btn-sm btn-ghost" %>
                  <%= button_to integration_path(integration), 
                      method: :delete,
                      class: "btn btn-sm btn-ghost btn-error",
                      data: { turbo_confirm: "Czy na pewno usunąć tę integrację?" } do %>
                    <%= lucide_icon("trash-2", class: "w-4 h-4") %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% else %>
    <!-- Empty State -->
    <div class="flex flex-col items-center justify-center py-16 px-4">
      <div class="w-20 h-20 rounded-full bg-base-200 flex items-center justify-center mb-4">
        <%= lucide_icon("plug", class: "w-10 h-10 text-base-content/30") %>
      </div>
      <h3 class="text-xl font-semibold mb-2">Brak integracji</h3>
      <p class="text-base-content/60 text-center max-w-md mb-6">
        Dodaj swoją pierwszą integrację, aby synchronizować dane z zewnętrznymi platformami.
      </p>
      <%= link_to "Dodaj integrację", new_integration_path, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>
