<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <div class="text-sm breadcrumbs">
        <ul>
          <li><%= link_to "Zamówienia", orders_path %></li>
          <li><%= @order.order_number %></li>
        </ul>
      </div>
      <h1 class="text-3xl font-bold">Zamówienie <%= @order.order_number %></h1>
    </div>
    <div class="flex gap-2">
      <%= link_to "Edytuj", edit_order_path(@order), class: "btn btn-primary" %>
      <%= button_to "Usuń", order_path(@order), method: :delete, class: "btn btn-error", data: { turbo_confirm: "Na pewno usunąć to zamówienie?" } %>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content - Left Column -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Order Items -->
      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <h2 class="card-title">Produkty</h2>
          <div class="overflow-x-auto">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Produkt</th>
                  <th>SKU</th>
                  <th>EAN</th>
                  <th class="text-right">Cena jedn.</th>
                  <th class="text-center">Ilość</th>
                  <th class="text-right">Suma</th>
                </tr>
              </thead>
              <tbody>
                <% @order.order_items.each do |item| %>
                  <tr>
                    <td>
                      <div class="font-medium"><%= item.name %></div>
                    </td>
                    <td><%= item.sku %></td>
                    <td><%= item.ean %></td>
                    <td class="text-right"><%= number_to_currency(item.unit_price, unit: @order.currency, format: "%n %u") %></td>
                    <td class="text-center"><%= item.quantity %></td>
                    <td class="text-right font-semibold"><%= number_to_currency(item.total_price, unit: @order.currency, format: "%n %u") %></td>
                  </tr>
                <% end %>
              </tbody>
              <tfoot>
                <tr class="font-semibold">
                  <td colspan="5" class="text-right">Produkty:</td>
                  <td class="text-right"><%= number_to_currency(@order.total_amount, unit: @order.currency, format: "%n %u") %></td>
                </tr>
                <tr class="font-semibold">
                  <td colspan="5" class="text-right">Dostawa (<%= @order.shipping_method || "Nie określono" %>):</td>
                  <td class="text-right"><%= number_to_currency(@order.shipping_cost, unit: @order.currency, format: "%n %u") %></td>
                </tr>
                <tr class="font-bold text-lg">
                  <td colspan="5" class="text-right">Suma całkowita:</td>
                  <td class="text-right"><%= number_to_currency(@order.total_amount + @order.shipping_cost, unit: @order.currency, format: "%n %u") %></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>

      <!-- Shipping Address -->
      <% if @order.shipping_address.present? %>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h2 class="card-title">Adres dostawy</h2>
            <div class="space-y-1">
              <p class="font-semibold"><%= [@order.shipping_address.first_name, @order.shipping_address.last_name].compact.join(" ") %></p>
              <p><%= @order.shipping_address.address_line1 %></p>
              <% if @order.shipping_address.address_line2.present? %>
                <p><%= @order.shipping_address.address_line2 %></p>
              <% end %>
              <p><%= @order.shipping_address.postal_code %> <%= @order.shipping_address.city %></p>
              <p><%= @order.shipping_address.country %></p>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Billing Address -->
      <% if @order.billing_address.present? %>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h2 class="card-title">
              Dane do faktury
              <% if @order.billing_address.needs_invoice %>
                <span class="badge badge-info">Faktura wymagana</span>
              <% end %>
            </h2>
            <div class="space-y-1">
              <% if @order.billing_address.company_name.present? %>
                <p class="font-semibold"><%= @order.billing_address.company_name %></p>
                <% if @order.billing_address.nip.present? %>
                  <p>NIP: <%= @order.billing_address.nip %></p>
                <% end %>
              <% end %>
              <p><%= [@order.billing_address.first_name, @order.billing_address.last_name].compact.join(" ") %></p>
              <p><%= @order.billing_address.address_line1 %></p>
              <% if @order.billing_address.address_line2.present? %>
                <p><%= @order.billing_address.address_line2 %></p>
              <% end %>
              <p><%= @order.billing_address.postal_code %> <%= @order.billing_address.city %></p>
              <p><%= @order.billing_address.country %></p>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Comment -->
      <% if @order.comment.present? %>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h2 class="card-title">Komentarz</h2>
            <p class="whitespace-pre-wrap"><%= @order.comment %></p>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Right Sidebar -->
    <div class="space-y-6">
      <!-- Order Info -->
      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <h2 class="card-title">Informacje o zamówieniu</h2>
          <div class="space-y-3">
            <div>
              <div class="text-sm opacity-60">Status</div>
              <% status_class = case @order.status
                when "sent" then "badge-info"
                when "processing" then "badge-warning"
                when "completed" then "badge-success"
                when "paid" then "badge-success"
                when "cancelled" then "badge-error"
                else "badge-ghost"
                end
              %>
              <span class="badge <%= status_class %> badge-lg">
                <%= {
                  "sent" => "Wysłane",
                  "processing" => "W trakcie",
                  "completed" => "Zrealizowane",
                  "paid" => "Opłacone",
                  "cancelled" => "Anulowane"
                }[@order.status] || @order.status %>
              </span>
            </div>

            <div class="divider my-2"></div>

            <div>
              <div class="text-sm opacity-60">Token zamówienia</div>
              <code class="text-xs"><%= @order.order_token %></code>
            </div>

            <div>
              <div class="text-sm opacity-60">Data utworzenia</div>
              <div class="font-medium"><%= @order.created_at.strftime("%d.%m.%Y %H:%M") %></div>
            </div>

            <div>
              <div class="text-sm opacity-60">Ostatnia aktualizacja</div>
              <div class="font-medium"><%= @order.updated_at.strftime("%d.%m.%Y %H:%M") %></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Customer Info -->
      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <h2 class="card-title">Klient</h2>
          <div class="space-y-3">
            <% if @order.customer.present? %>
              <div>
                <div class="text-sm opacity-60">Nazwa</div>
                <div class="font-medium"><%= @order.customer.name %></div>
              </div>
            <% end %>

            <% if @order.email.present? %>
              <div>
                <div class="text-sm opacity-60">Email</div>
                <div><%= mail_to @order.email, class: "link link-primary" %></div>
              </div>
            <% end %>

            <% if @order.phone.present? %>
              <div>
                <div class="text-sm opacity-60">Telefon</div>
                <div><%= @order.phone %></div>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Summary -->
      <div class="card bg-primary text-primary-content shadow">
        <div class="card-body">
          <h2 class="card-title">Podsumowanie</h2>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span>Produkty:</span>
              <span class="font-semibold"><%= number_to_currency(@order.total_amount, unit: @order.currency, format: "%n %u") %></span>
            </div>
            <div class="flex justify-between">
              <span>Dostawa:</span>
              <span class="font-semibold"><%= number_to_currency(@order.shipping_cost, unit: @order.currency, format: "%n %u") %></span>
            </div>
            <div class="divider my-1"></div>
            <div class="flex justify-between text-xl font-bold">
              <span>Razem:</span>
              <span><%= number_to_currency(@order.total_amount + @order.shipping_cost, unit: @order.currency, format: "%n %u") %></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
