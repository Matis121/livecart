<%= turbo_frame_tag dom_id(order, :checkout) do %>
  <div class="card bg-base-100 shadow-sm border border-base-300">
    <div class="card-body p-3">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <%# LEWA STRONA: Tytuł i Status %>
        <div class="flex items-center gap-3">
          <div class="flex items-center gap-1.5 shrink-0">
            <%= lucide_icon "shopping-cart", class: "w-4 h-4 text-primary" %>
            <h3 class="font-semibold text-sm">Koszyk</h3>
          </div>
          <% if order.checkout.present? && (order.checkout.active? || order.checkout&.completed?) %>
            <div class="flex items-center gap-2 border-l border-base-300 pl-3">
              <%= checkout_status_badge(order.checkout) %>
              <span class="text-[11px] opacity-70"><%= checkout_expiry_info(order.checkout) %></span>
            </div>
          <% end %>
        </div>
        <%# PRAWA STRONA: Link i Akcje %>
        <div class="flex items-center gap-2 flex-1 justify-end min-w-fit">
          <% if order.checkout.present? && (order.checkout.active? || order.checkout&.completed?) %>
            <div class="flex items-center gap-1 bg-base-200 rounded-lg p-1 pr-2 max-w-xs group">
              <button type="button"
                      onclick="navigator.clipboard.writeText('<%= order.checkout.public_url %>'); this.classList.add('btn-success'); setTimeout(() => this.classList.remove('btn-success'), 2000)"
                class="btn btn-ghost btn-xs btn-square shrink-0"
                title="Kopiuj link">
                <%= lucide_icon "copy", class: "w-3 h-3" %>
              </button>
              <a href="<%= order.checkout.public_url %>"
                 target="_blank"
                 class="text-[11px] font-mono text-primary hover:underline truncate">
                Link do koszyka
              </a>
            </div>
            <% unless order.checkout.completed? %>
              <%= link_to cancel_checkout_order_path(order),
                          class: "btn btn-ghost btn-xs text-error hover:bg-error/10 shrink-0",
                          data: { turbo_method: :delete, turbo_confirm: "Czy na pewno chcesz anulować koszyk?" } do %>
                <%= lucide_icon "x", class: "w-3 h-3" %>
              <% end %>
            <% end %>
          <% else %>
            <%# Stan pusty - inline %>
            <span class="text-xs text-base-content/50 mr-1 ">Brak aktywnego linku</span>
            <%= link_to activate_checkout_order_path(order),
                        class: "btn btn-primary btn-xs gap-1",
                        data: { turbo_method: :post } do %>
              <%= lucide_icon "link", class: "w-3 h-3" %>
              Wygeneruj
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>