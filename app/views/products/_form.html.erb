<%= form_with model: @product, local: true, html: { multipart: true } do |f| %>
  <div class="space-y-8">
    <%# ===== SEKCJA: INFORMACJE PODSTAWOWE ===== %>
    <section>
      <h3 class="text-lg font-semibold mb-2">Informacje podstawowe</h3>
      <div class="space-y-2">
        <div class="form-control w-full">
          <%= f.label :name, "Nazwa produktu", class: "label" %>
          <%= f.text_field :name, class: "input input-bordered w-full focus:input-primary", placeholder: "np. Koszulka męska" %>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-control w-full">
            <%= f.label :sku, "SKU", class: "label" %>
            <%= f.text_field :sku, class: "input input-bordered w-full focus:input-primary", placeholder: "np. KOSZ-001" %>
          </div>
          <div class="form-control w-full">
            <%= f.label :ean, "EAN", class: "label" %>
            <%= f.text_field :ean, class: "input input-bordered w-full focus:input-primary", placeholder: "np. 5901234123457" %>
          </div>
        </div>
      </div>
    </section>
    <%# ===== SEKCJA: CENA I MAGAZYN ===== %>
    <section>
      <h3 class="text-lg font-semibold mb-4">Cena i magazyn</h3>
      <div class="space-y-2">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="form-control w-full">
            <%= f.label :gross_price, "Cena domyślna", class: "label" %>
            <%= f.number_field :gross_price, class: "input input-bordered w-full focus:input-primary", step: 0.01, min: 0, placeholder: "99.99" %>
          </div>
          <div class="form-control w-full">
            <%= f.label :tax_rate, "VAT", class: "label" %>
            <%= f.select :tax_rate, [["23%", 23], ["8%", 8], ["5%", 5], ["0%", 0]], {}, class: "select select-bordered w-full focus:select-primary" %>
          </div>
          <div class="form-control w-full">
            <%= f.label :currency, "Waluta", class: "label" %>
            <%= f.select :currency, [["PLN", "PLN"], ["EUR", "EUR"], ["USD", "USD"]], {}, class: "select select-bordered w-full focus:select-primary" %>
          </div>
        </div>
        <%= f.fields_for :product_stock do |stock_fields| %>
          <div class="form-control w-full max-w-xs">
            <%= stock_fields.label :quantity, "Stan magazynowy", class: "label" %>
            <%= stock_fields.number_field :quantity, class: "input input-bordered w-full focus:input-primary", placeholder: "0" %>
          </div>
        <% end %>
      </div>
    </section>
    <%# ===== SEKCJA: ZDJĘCIA ===== %>
    <section>
      <h3 class="text-lg font-semibold mb-4">Zdjęcia</h3>
      <% if @product.images.attached? %>
        <p class="text-sm text-gray-500 mb-3">Zaznacz zdjęcia do usunięcia:</p>
        <div class="grid grid-cols-2 md:grid-cols-6 lg:grid-cols-8 gap-3 mb-4">
          <% @product.images.each do |image| %>
            <div class="relative group">
              <%= image_tag image, class: "w-full aspect-square object-cover rounded-lg border" %>
              <label class="absolute top-1 right-1 flex items-center gap-1 bg-error/90 text-white px-2 py-1 rounded text-xs cursor-pointer hover:bg-error">
                <%= check_box_tag "product[images_to_delete][]", image.id, false, class: "checkbox checkbox-xs" %>
                Usuń
              </label>
            </div>
          <% end %>
        </div>
      <% end %>
      <div class="form-control w-full">
        <%= f.file_field :images, multiple: true, accept: "image/png,image/jpeg", class: "file-input file-input-bordered w-full focus:file-input-primary" %>
        <label class="label">
          <span class="label-text-alt text-gray-500">PNG, JPEG • maks. 5MB</span>
        </label>
      </div>
    </section>
  </div>
  <%# ===== PRZYCISKI ===== %>
  <div class="flex gap-2 pt-6">
    <%= f.submit @product.persisted? ? "Zapisz zmiany" : "Dodaj produkt", class: "btn btn-primary" %>
    <%= link_to "Anuluj", products_path, class: "btn btn-ghost" %>
  </div>
<% end %>