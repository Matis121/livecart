<div class="mb-4" data-controller="collapse" data-collapse-storage-key-value="products-filters-open" data-collapse-default-open-value="true">
  <!-- Formularz wyszukiwania -->
  <%= search_form_for @q, url: products_path, method: :get, html: { class: "mb-4" } do |f| %>
    <div class="bg-base-100 rounded-lg shadow-sm">
      <!-- Header z przyciskiem toggle -->
      <div class="flex items-center justify-between p-4 border-b border-base-200">
        <h3 class="text-sm font-semibold flex items-center gap-2">
          <%= lucide_icon('filter', class: 'w-4 h-4') %>
          Filtry
        </h3>
        <button 
          type="button"
          data-action="click->collapse#toggle"
          class="btn btn-ghost flex gap-2"
          >
          <%= lucide_icon('chevron-down', class: 'w-5 h-5 transition-transform', data: { collapse_target: 'icon' }) %>
        </button>
      </div>
      <!-- Zawartość filtrów -->
      <div data-collapse-target="content" class="p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3">
          <!-- Nazwa -->
          <div class="form-control">
            <%= f.label :name_cont, "Nazwa", class: "label label-text text-xs" %>
            <%= f.search_field :name_cont, 
                placeholder: "Szukaj po nazwie...",
                class: "input input-sm input-bordered w-full" %>
          </div>
          <!-- EAN -->
          <div class="form-control">
            <%= f.label :ean_cont, "EAN", class: "label label-text text-xs" %>
            <%= f.search_field :ean_cont, 
                placeholder: "Szukaj po EAN...",
                class: "input input-sm input-bordered w-full" %>
          </div>
          <!-- SKU -->
          <div class="form-control">
            <%= f.label :sku_cont, "SKU", class: "label label-text text-xs" %>
            <%= f.search_field :sku_cont, 
                placeholder: "Szukaj po SKU...",
                class: "input input-sm input-bordered w-full" %>
          </div>
          <!-- Stan od -->
          <div class="form-control">
            <%= f.label :product_stock_quantity_gteq, "Stan od", class: "label label-text text-xs" %>
            <%= f.number_field :product_stock_quantity_gteq, 
                placeholder: "Min...",
                class: "input input-sm input-bordered w-full" %>
          </div>
          <!-- Stan do -->
          <div class="form-control">
            <%= f.label :product_stock_quantity_lteq, "Stan do", class: "label label-text text-xs" %>
            <%= f.number_field :product_stock_quantity_lteq, 
                placeholder: "Max...",
                class: "input input-sm input-bordered w-full" %>
          </div>
          <!-- Cena od -->
          <div class="form-control">
            <%= f.label :gross_price_gteq, "Cena od", class: "label label-text text-xs" %>
            <%= f.number_field :gross_price_gteq, 
                placeholder: "Min...",
                step: "0.01",
                class: "input input-sm input-bordered w-full" %>
          </div>
          <!-- Cena do -->
          <div class="form-control">
            <%= f.label :gross_price_lteq, "Cena do", class: "label label-text text-xs" %>
            <%= f.number_field :gross_price_lteq, 
                placeholder: "Max...",
                step: "0.01",
                class: "input input-sm input-bordered w-full" %>
          </div>
        </div>
        <!-- Przyciski -->
        <div class="flex justify-end gap-2 mt-6">
          <%= link_to "Wyczyść", products_path, class: "btn btn-sm btn-ghost" %>
          <%= f.submit "Filtruj", class: "btn btn-sm btn-primary" %>
        </div>
      </div>
    </div>
  <% end %>
  <!-- Pagination controls -->
  <div class="flex items-center justify-between gap-3 text-sm text-base-content/60 mt-3">
    <div class="flex items-center gap-2" >
      <div class="dropdown dropdown-start" data-checkbox-select-all-target="parent">
        <label tabindex="0" class="btn btn-sm bg-base-100 flex items-center gap-2">
          <%= lucide_icon('check-square', class: 'w-4 h-4') %>
          <span 
                class="font-medium tabular-nums hidden" 
                data-checkbox-select-all-target="counter"
            >
            0 / <%= @products.count %>
          </span>
        </label>
        <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
          <li><a data-action="click->checkbox-select-all#toggleChildren" data-value="true">Zaznacz wszystkie</a></li>
          <li><a data-action="click->checkbox-select-all#toggleChildren" value="false">Odznacz wszystkie</a></li>
        </ul>
      </div>
      <%= form_with url: bulk_action_products_path, method: :patch, id: "bulk_action_form" do |f| %>
        <%= render "products/bulk_actions_toolbar" %>
      <% end %>
      <%= form_with url: bulk_action_products_path, method: :post, id: "bulk_action_form", data: { turbo: false } do |f| %>
        <%= render "products/bulk_actions_export" %>
      <% end %>
    </div>
    <div class="flex gap-4">
      <!-- Per page selector -->
      <div class="flex items-center gap-2">
        <select
        onchange="window.location.href = this.value"
        class="select select-sm select-bordered bg-base-100 min-h-0 h-8 pr-8"
      >
          <% @per_page_options.each do |option| %>
            <option
            value="<%= products_path(request.params.merge(per_page: option, page: 1)) %>"
            <%= 'selected' if @pagy.limit == option %>
          >
              <%= option %>
            </option>
          <% end %>
        </select>
      </div>
      <!-- Page navigation -->
      <div class="flex items-center gap-1">
        <% if @pagy.page > 1 %>
          <%= link_to products_path(request.params.merge(page: @pagy.page - 1)), class: "p-1 rounded hover:bg-base-200 transition-colors" do %>
            <%= lucide_icon('chevron-left', class: 'w-4 h-4') %>
          <% end %>
        <% else %>
          <span class="p-1 opacity-30"><%= lucide_icon('chevron-left', class: 'w-4 h-4') %></span>
        <% end %>
        <span class="px-2 tabular-nums"><%= @pagy.page %> / <%= @pagy.pages %></span>
        <% if @pagy.page < @pagy.pages %>
          <%= link_to products_path(request.params.merge(page: @pagy.page + 1)), class: "p-1 rounded hover:bg-base-200 transition-colors" do %>
            <%= lucide_icon('chevron-right', class: 'w-4 h-4') %>
          <% end %>
        <% else %>
          <span class="p-1 opacity-30"><%= lucide_icon('chevron-right', class: 'w-4 h-4') %></span>
        <% end %>
      </div>
    </div>
  </div>
</div>
