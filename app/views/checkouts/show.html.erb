<!-- app/views/checkouts/show.html.erb -->
<div class="container mx-auto px-4 py-8 max-w-4xl">
  
  <% if @checkout.completed? %>
    <!-- Strona sukcesu - minimalistyczny styl -->
    <div class="max-w-2xl mx-auto py-16">
      <!-- Header -->
      <div class="text-center mb-12">
        <div class="inline-flex items-center justify-center w-16 h-16 mb-6">
          <%= lucide_icon "check", class: "w-16 h-16 text-base-content/40 stroke-[1.5]" %>
        </div>
        <h1 class="text-3xl font-light mb-2 tracking-tight">Zamówienie złożone</h1>
        <p class="text-base-content/50">Dziękujemy za zakup</p>
      </div>
      
      <!-- Główna karta z detalami -->
      <div class="bg-base-100 border border-base-300 rounded-lg p-8 mb-6">
        <!-- Numer zamówienia -->
        <div class="mb-8">
          <div class="text-xs uppercase tracking-wider text-base-content/40 mb-1">Zamówienie</div>
          <div class="text-2xl font-light tracking-tight">#<%= @order.order_number %></div>
        </div>
        
        <!-- Grid z detalami -->
        <div class="grid grid-cols-2 gap-x-8 gap-y-6 mb-8 pb-8 border-b border-base-300">
          <div>
            <div class="text-xs uppercase tracking-wider text-base-content/40 mb-1">Email</div>
            <div class="text-sm"><%= @order.email %></div>
          </div>
          
          <div>
            <div class="text-xs uppercase tracking-wider text-base-content/40 mb-1">Status</div>
            <div class="text-sm"><%= @order.status_name %></div>
          </div>
        </div>
        
        <!-- Produkty -->
        <div class="space-y-4 mb-6">
          <% @order.order_items.includes(:product).each do |item| %>
            <div class="flex justify-between items-start py-3">
              <div class="flex-1">
                <div class="text-sm font-medium mb-1"><%= item.product&.name || "Produkt" %></div>
                <div class="text-xs text-base-content/40">
                  <%= item.quantity %> × <%= number_to_currency(item.unit_price, unit: "zł") %>
                </div>
              </div>
              <div class="text-sm font-medium">
                <%= number_to_currency(item.total_price, unit: "zł") %>
              </div>
            </div>
          <% end %>
        </div>
        
        <!-- Podsumowanie -->
        <div class="pt-6 border-t border-base-300 space-y-3">
          <% if @order.shipping_cost > 0 %>
            <div class="flex justify-between text-sm">
              <span class="text-base-content/60">Dostawa</span>
              <span><%= number_to_currency(@order.shipping_cost, unit: "zł") %></span>
            </div>
          <% end %>
          
          <div class="flex justify-between items-center pt-3">
            <span class="text-base font-light">Razem</span>
            <span class="text-2xl font-light tracking-tight">
              <%= number_to_currency(@order.total_amount, unit: "zł") %>
            </span>
          </div>
        </div>
      </div>
      
      <!-- Informacja o emailu -->
      <div class="text-center">
        <p class="text-sm text-base-content/40">
          Potwierdzenie wysłano na <span class="text-base-content/60"><%= @order.email %></span>
        </p>
      </div>
    </div>
    
  <% else %>
    <!-- Formularz zamówienia -->
    <h1 class="text-3xl font-bold mb-6">Finalizacja zamówienia</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Lewa kolumna - Formularz -->
    <div class="lg:col-span-2 space-y-6">
      <%= form_with model: @order, url: checkout_path(@checkout.token), method: :patch, local: true do |f| %>
        
        <!-- Dane kontaktowe -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title flex items-center gap-2">
              <%= lucide_icon "user", class: "w-5 h-5" %>
              Dane kontaktowe
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="form-control">
                <%= f.label :email, "Email *", class: "label" %>
                <%= f.email_field :email, 
                    class: "input input-bordered w-full", 
                    required: true,
                    placeholder: "twoj@email.pl" %>
              </div>
              
              <div class="form-control">
                <%= f.label :phone, "Telefon *", class: "label" %>
                <%= f.telephone_field :phone, 
                    class: "input input-bordered w-full", 
                    required: true,
                    placeholder: "+48 123 456 789" %>
              </div>
            </div>
          </div>
        </div>

        <!-- Adres dostawy -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title flex items-center gap-2">
              <%= lucide_icon "truck", class: "w-5 h-5" %>
              Adres dostawy
            </h2>
            
            <%= f.fields_for :shipping_address_attributes, @order.shipping_address do |sa| %>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-control">
                  <%= sa.label :first_name, "Imię *", class: "label" %>
                  <%= sa.text_field :first_name, 
                      class: "input input-bordered w-full", 
                      required: true %>
                </div>
                
                <div class="form-control">
                  <%= sa.label :last_name, "Nazwisko *", class: "label" %>
                  <%= sa.text_field :last_name, 
                      class: "input input-bordered w-full", 
                      required: true %>
                </div>
                
                <div class="form-control md:col-span-2">
                  <%= sa.label :address_line1, "Ulica i numer *", class: "label" %>
                  <%= sa.text_field :address_line1, 
                      class: "input input-bordered w-full", 
                      required: true,
                      placeholder: "np. ul. Główna 123" %>
                </div>
                
                <div class="form-control md:col-span-2">
                  <%= sa.label :address_line2, "Dodatkowe informacje", class: "label" %>
                  <%= sa.text_field :address_line2, 
                      class: "input input-bordered w-full",
                      placeholder: "np. mieszkanie 4, kod domofonu" %>
                </div>
                
                <div class="form-control">
                  <%= sa.label :postal_code, "Kod pocztowy *", class: "label" %>
                  <%= sa.text_field :postal_code, 
                      class: "input input-bordered w-full", 
                      required: true,
                      placeholder: "00-000" %>
                </div>
                
                <div class="form-control">
                  <%= sa.label :city, "Miasto *", class: "label" %>
                  <%= sa.text_field :city, 
                      class: "input input-bordered w-full", 
                      required: true %>
                </div>
                
                <div class="form-control md:col-span-2">
                  <%= sa.label :country, "Kraj *", class: "label" %>
                  <%= sa.text_field :country, 
                      class: "input input-bordered w-full", 
                      required: true,
                      value: "Polska" %>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- Dane do faktury -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title flex items-center gap-2">
              <%= lucide_icon "file-text", class: "w-5 h-5" %>
              Dane do faktury
            </h2>
            
            <%= f.fields_for :billing_address_attributes, @order.billing_address do |ba| %>
              <div class="form-control mb-4">
                <label class="label cursor-pointer justify-start gap-3">
                  <%= ba.check_box :needs_invoice, 
                      class: "checkbox checkbox-primary",
                      onchange: "document.getElementById('invoice-fields').classList.toggle('hidden')" %>
                  <span class="label-text font-medium">Chcę otrzymać fakturę VAT</span>
                </label>
              </div>
              
              <div id="invoice-fields" class="<%= 'hidden' unless @order.billing_address.needs_invoice %> space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div class="form-control md:col-span-2">
                    <%= ba.label :company_name, "Nazwa firmy", class: "label" %>
                    <%= ba.text_field :company_name, 
                        class: "input input-bordered w-full" %>
                  </div>
                  
                  <div class="form-control">
                    <%= ba.label :nip, "NIP", class: "label" %>
                    <%= ba.text_field :nip, 
                        class: "input input-bordered w-full",
                        placeholder: "0000000000" %>
                  </div>
                  
                  <div class="form-control">
                    <%= ba.label :first_name, "Imię", class: "label" %>
                    <%= ba.text_field :first_name, 
                        class: "input input-bordered w-full" %>
                  </div>
                  
                  <div class="form-control">
                    <%= ba.label :last_name, "Nazwisko", class: "label" %>
                    <%= ba.text_field :last_name, 
                        class: "input input-bordered w-full" %>
                  </div>
                  
                  <div class="form-control md:col-span-2">
                    <%= ba.label :address_line1, "Ulica i numer", class: "label" %>
                    <%= ba.text_field :address_line1, 
                        class: "input input-bordered w-full" %>
                  </div>
                  
                  <div class="form-control">
                    <%= ba.label :postal_code, "Kod pocztowy", class: "label" %>
                    <%= ba.text_field :postal_code, 
                        class: "input input-bordered w-full",
                        placeholder: "00-000" %>
                  </div>
                  
                  <div class="form-control">
                    <%= ba.label :city, "Miasto", class: "label" %>
                    <%= ba.text_field :city, 
                        class: "input input-bordered w-full" %>
                  </div>
                  
                  <div class="form-control md:col-span-2">
                    <%= ba.label :country, "Kraj", class: "label" %>
                    <%= ba.text_field :country, 
                        class: "input input-bordered w-full",
                        value: "Polska" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- Metoda płatności i dostawy -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title flex items-center gap-2">
              <%= lucide_icon "credit-card", class: "w-5 h-5" %>
              Płatność i dostawa
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="form-control">
                <%= f.label :payment_method, "Metoda płatności *", class: "label" %>
                <%= f.select :payment_method, 
                    [
                      ["Przelew bankowy", "bank_transfer"],
                      ["Płatność online", "online"],
                      ["Za pobraniem", "cod"],
                      ["BLIK", "blik"]
                    ],
                    { include_blank: "Wybierz metodę płatności" },
                    { class: "select select-bordered w-full", required: true } %>
              </div>
              
              <div class="form-control">
                <%= f.label :shipping_method, "Metoda dostawy *", class: "label" %>
                <%= f.select :shipping_method,
                    [
                      ["Kurier InPost", "inpost_courier"],
                      ["Paczkomat InPost", "inpost_locker"],
                      ["DPD", "dpd"],
                      ["Odbiór osobisty", "pickup"]
                    ],
                    { include_blank: "Wybierz metodę dostawy" },
                    { class: "select select-bordered w-full", required: true } %>
              </div>
            </div>
          </div>
        </div>

        <!-- Przycisk finalizacji -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <div class="form-control">
              <label class="label cursor-pointer justify-start gap-3">
                <input type="checkbox" class="checkbox checkbox-primary" required />
                <span class="label-text">Akceptuję regulamin i politykę prywatności *</span>
              </label>
            </div>
            
            <%= f.submit "Złóż zamówienie", 
                class: "btn btn-primary btn-lg w-full mt-4",
                data: { disable_with: "Przetwarzanie..." } %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Prawa kolumna - Podsumowanie -->
    <div class="lg:col-span-1">
      <div class="card bg-base-100 shadow-lg sticky top-4">
        <div class="card-body">
          <h2 class="card-title text-lg">Podsumowanie zamówienia</h2>
          
          <div class="divider my-2"></div>
          
          <% if @order.order_items.any? %>
            <div class="space-y-3">
              <% @order.order_items.includes(:product).each do |item| %>
                <div class="flex justify-between text-sm">
                  <div class="flex-1">
                    <div class="font-medium"><%= item.product&.name || "Produkt" %></div>
                    <div class="text-xs text-base-content/60">
                      <%= item.quantity %> × <%= number_to_currency(item.unit_price, unit: "zł") %>
                    </div>
                  </div>
                  <div class="font-semibold">
                    <%= number_to_currency(item.total_price, unit: "zł") %>
                  </div>
                </div>
              <% end %>
            </div>
            
            <div class="divider my-2"></div>
            
            <% if @order.shipping_cost > 0 %>
              <div class="flex justify-between text-sm">
                <span>Dostawa:</span>
                <span class="font-semibold"><%= number_to_currency(@order.shipping_cost, unit: "zł") %></span>
              </div>
            <% end %>
            
            <div class="flex justify-between items-center pt-2">
              <span class="text-lg font-bold">Razem:</span>
              <span class="text-2xl font-bold text-primary">
                <%= number_to_currency(@order.total_amount, unit: "zł") %>
              </span>
            </div>
          <% else %>
            <div class="alert alert-warning">
              <span class="text-xs">Brak produktów</span>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    </div>
  <% end %>
</div>